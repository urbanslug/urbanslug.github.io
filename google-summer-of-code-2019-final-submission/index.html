<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="referrer" content="no-referrer">

        <!-- Enable responsiveness on mobile devices-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

        <title>Google Summer of Code 2019—Final Submission | Mostly Programming</title>
<meta property="og:title" content="Google Summer of Code 2019—Final Submission | Mostly Programming" />
<meta name="twitter:title" content="Google Summer of Code 2019—Final Submission | Mostly Programming" />

        

        <meta property="og:site_name" content="Mostly Programming" />
        <meta property="og:url" content="https:&#x2F;&#x2F;blog.njagi.me" />

        


        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;base.css" />
        <link rel="stylesheet" href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;style.css">
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro&display=swap" rel="stylesheet">
        <link href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;fontawesome&#x2F;fontawesome.css" rel="stylesheet">
        <link href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;fontawesome&#x2F;brands.css" rel="stylesheet">
        <link href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;fontawesome&#x2F;solid.css" rel="stylesheet">

        <link rel='icon' type='image/x-icon' href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;favicon.ico" />

        

        

    </head>
    <body>
        <a href="#main" class="skip-link p-screen-reader-text">Skip to content</a>
        

        
        <div id="taxonomy-header"></div>
        

        <main id="main" class="l-main">
            
<article class="p-article">
  <header>
    <a id="home-link" href="https:&#x2F;&#x2F;blog.njagi.me"><i class="fas fa-home"></i> Mostly Programming</a>
    <h1 id="page-title">Google Summer of Code 2019—Final Submission</h1>
        <div>
            <div class="c-time">

              <time datetime="2019-08-20">
                Aug 20, 2019
              </time>
              
               - (9 min read)
            </div>
        </div>
    </header>
    
    <section id="js-article" class="p-article__body">
        
    <p>The Google Summer of Code for 2019 is coming to a close. I've been working on
the <a href="https://github.com/urbanslug/graphite">Graphite</a> project aimed at creating a variation graph tool under the
<a href="https://www.open-bio.org">Open Bioinformatics Foundation</a>.</p>
<span id="continue-reading"></span><h1 id="genome-graphs">Genome Graphs<a class="zola-anchor" href="#genome-graphs" aria-label="Anchor link for: genome-graphs"><i class="fas fa-link"></i></a> 
</h1>
<p>I shall give an overview of genome graphs; for a more thorough introduction, I
advise reading  <a href="https://lh3.github.io/2019/07/08/on-a-reference-pan-genome-model">On a reference pan-genome model</a> or my very own
<a href="https://blog.njagi.me/google-summer-of-code-2019-final-submission/2019-06-22-Introduction-to-Variation-Graphs.html">An Introduction to Variation Graphs</a>.</p>
<p><a href="https://ekg.github.io/2019/07/09/Untangling-graphical-pangenomics">Variation graphs</a> are a class of <a href="https://www.biorxiv.org/content/10.1101/101378v1">genome graphs</a> that, among other things,
maintain:</p>
<ul>
<li>path information—a full walk within the graph along the edges</li>
<li>a strong mapping between nodes on the graph and their positions on the
reference</li>
</ul>
<p>All this with the main aim of representing genomic variation.</p>
<p>Currently genomes are represented as a consensus; for example, here's part of
<a href="https://github.com/vgteam/vg/blob/master/test/1mb1kgp/z.fa">chromosome 20 of the human genome</a>:</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#1f1f1f;">TGGGAGAGAACTGGAACAAGAACCCAGTGCTCTTTCTGCTCTACCCACTGACCCATCCTCTCACGCATCATACACCCATA
CTCCCATCCACCCACCTTCCCATTCATGCATTCACCCATTCACCCACCTTCCATCCATCTACCATCCACCACGTACCTAC
ACTCCCATCTACCATCCAACCACATTTCCATTCACCCATCCTCCCATCCATCAACCCTCCAATCCACCACCCACAGACCT
TCCCATCCATTCATTTACCCATCCACATATTCACCCACCCTCCCATCCATCCATCTACTGTCTATCACCTACTCATTTTC
...
</span></code></pre>
<p>However, variation <strong>does</strong> exist on this chromosome between individuals.
To demonstrate, when <a href="https://github.com/vgteam/vg/blob/master/test/1mb1kgp/z.vcf.gz">a single file of variation data</a> is &quot;applied&quot; to it we end
up with a graph that can be represented as in the  below zoomed in section of
chromosome 20.
<img src="/images/Content/Graphs/chr20.png" alt="chr20" /></p>
<p>Not all graphs are linear like the one above; in fact, the kind of graphs we're
hoping to generate soon will have many breaks and will look pretty jumbled up.
The amount of variation within and between genomes depends on a lot of factors
including but not limited to the organism(s) whose genomes are studying and how
evolutionarily distant the genomes we are comparing are (pan-genomes).</p>
<h2 id="reference-bias">Reference Bias<a class="zola-anchor" href="#reference-bias" aria-label="Anchor link for: reference-bias"><i class="fas fa-link"></i></a> 
</h2>
<p>The reference being a consensus introduces a problem known as <a href="https://www.sevenbridges.com/reference-bias-challenges-and-solutions/">reference bias</a>;
which is analogous to a false negative during read mapping, that is, claiming
that a variation does not exist where it actually exists.
<a href="https://www.nature.com/articles/nbt.4227">Research</a> has shown an improvement in read mapping of short read data when
short reads are mapped to a reference graph instead of a reference consensus.</p>
<p>Currently, graphite shows that we can generate a graph from a reference and
variation data and progressively update it; not far from what Heng Li theorizes
in: <a href="https://lh3.github.io/2019/07/08/on-a-reference-pan-genome-model">On a reference pan-genome model</a>.
We plan on supporting the generation of graphs from short and long-read data on
its own (de novo), you can track its progress under
<a href="https://github.com/urbanslug/graphite/projects/1">the alignment project board</a>.</p>
<h1 id="why-racket">Why Racket?<a class="zola-anchor" href="#why-racket" aria-label="Anchor link for: why-racket"><i class="fas fa-link"></i></a> 
</h1>
<p>You may wonder why Graphite is written in Racket yet the project name is
<a href="https://summerofcode.withgoogle.com/projects/#4733198808907776">Add Variant Graph (VG) support to BioD</a>.
Genome graphs have been theorized and written about for a while now but there
are only a few tools that implement them and there has been even much less use
by bioinformaticians.</p>
<p>We decided to build something people can use over just adding variation graph
support to <a href="https://github.com/biod/biod">BioD</a> believing that it would've taken me longer to write something
people could use in D.</p>
<h2 id="why-racket-not-another-language-or-lisp">Why Racket Not Another Language or Lisp?<a class="zola-anchor" href="#why-racket-not-another-language-or-lisp" aria-label="Anchor link for: why-racket-not-another-language-or-lisp"><i class="fas fa-link"></i></a> 
</h2>
<p>I have experience in functional programming and particularly
professional experience with LISPs, I could, therefore, move much faster in it.
Racket is a good LISP to use when working in an unfamiliar domain because it has
a <strong>straightforward build system</strong> compared to the overhead of the JVM and
leiningen in the most popular LISP, Clojure does and has an
<strong>easy to use C/C++ FFI</strong>, languages used in a lot of Bioinformatics
applications and libraries. Being <strong>untyped</strong> and programming in LISP being
<strong>REPL driven</strong> also helps to venture into unfamiliar territory.
Racket has <strong>immutability</strong> in a lot, if not all, of its data structures which
also helps with all the data manipulation we would have to do. Finally, Racket
also <strong>implements core programming concepts elegantly</strong> compared to many other
languages for example with its hygienic macros.</p>
<p>This shouldn't make the D community feel betrayed because given what
we know now, we can always go back and reimplement either all or part of
Graphite in D, especially for the possible performance improvements.</p>
<h1 id="done">Done<a class="zola-anchor" href="#done" aria-label="Anchor link for: done"><i class="fas fa-link"></i></a> 
</h1>
<p>For the fine detail install and set up Graphite as instructed in the <a href="https://github.com/urbanslug/graphite#graphite">README</a>
and run <code>graphite --help</code>.</p>
<h2 id="underlying-graph-representation">Underlying Graph Representation<a class="zola-anchor" href="#underlying-graph-representation" aria-label="Anchor link for: underlying-graph-representation"><i class="fas fa-link"></i></a> 
</h2>
<p>We implemented the graph as an association hash table. I went into more detail
on how it's built and the rationale behind certain choices in
<a href="https://blog.njagi.me/google-summer-of-code-2019-final-submission/2019-07-15-Creating-the-Initial-Variation-Graph.html">Creating the Initial Variation Graph</a> and <a href="https://blog.njagi.me/google-summer-of-code-2019-final-submission/2019-07-21-Justifying-SHA256-in-Graphite.html">Justifying SHA256 in Graphite</a>.</p>
<h2 id="construct">Construct<a class="zola-anchor" href="#construct" aria-label="Anchor link for: construct"><i class="fas fa-link"></i></a> 
</h2>
<p>Graphite allows you to build an initial graph out of a reference in
<a href="https://en.wikipedia.org/wiki/FASTA_format">FASTA format</a> and a <a href="https://en.wikipedia.org/wiki/Variant_Call_Format">VCF</a> file.
In the example below I output a serialized graph but you can output <code>.dot</code> or
<code>.gfa</code>.</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#1f1f1f;">./bin/graphite construct \
 -o rsv1.gra \
 -f gra \
 data/RSV/refererence_and_vcf_file/9465113.fa data/RSV/refererence_and_vcf_file/H_3801_22_04.freebayes.vcf
</span></code></pre><h2 id="update">Update<a class="zola-anchor" href="#update" aria-label="Anchor link for: update"><i class="fas fa-link"></i></a> 
</h2>
<p>Formally, <em>progressive construction</em>. Graphite lets the user update a serialized
graph generated via <code>construct</code>.
In the update, it takes serialized graph <code>.gra</code> and variation data in VCF.
Example:</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#1f1f1f;">./bin/graphite update \
 -o rsv2.dot \
 -f dot \
 rsv1.gra data/RSV/refererence_and_vcf_file/fake_H_3801_22_04.freebayes.vcf
</span></code></pre><h2 id="view">View<a class="zola-anchor" href="#view" aria-label="Anchor link for: view"><i class="fas fa-link"></i></a> 
</h2>
<p>Graphite allows you to generate graphs in</p>
<ul>
<li><strong>dot</strong> for visualization via <a href="https://en.wikipedia.org/wiki/Graphviz">GraphViz</a></li>
<li><strong>gfa</strong> for visualization with tools like <a href="https://rrwick.github.io/Bandage/">bandage</a></li>
<li><strong>gra</strong> a serialized graph, it can't be visualized.</li>
</ul>
<p>Using <code>update</code> and <code>view</code>, one can visualize changes introduced by different VCF
files as of writing this.
The view command takes a serialized graph <code>.gra</code>, an output format, and an output
file as arguments.
Example:</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#1f1f1f;">./bin/graphite view \
 -o rsv1.dot \
 -f dot \
 rsv1.gra
</span></code></pre><h1 id="to-do">To Do<a class="zola-anchor" href="#to-do" aria-label="Anchor link for: to-do"><i class="fas fa-link"></i></a> 
</h1>
<p>Look at the <a href="https://github.com/urbanslug/graphite/projects">Graphite project boards</a> for further detail.</p>
<h2 id="partial-order-alignment">Partial Order Alignment<a class="zola-anchor" href="#partial-order-alignment" aria-label="Anchor link for: partial-order-alignment"><i class="fas fa-link"></i></a> 
</h2>
<p>This would allow for aligning reads to a graph or against each other bypassing
the consensus reference.</p>
<p>For now, graphite can only align against strings (however this functionality
isn't exposed because it's not ready yet) mainly because it only
stores forward edges which makes it hard to implement
Partial Order Alignment (POA) which strictly depends on backward edges.
The short term options are adding a pre-processing
step to generate backward edges or using Racket's FFI to call <a href="https://github.com/rvaser/spoa">spoa</a> or <a href="https://github.com/vgteam/gssw">gssw</a>.
In the medium to long term Graphite's nodes should support backward edges which
would, on top of assisting with POA, allow for encoding more complex mutations
such as inversions.</p>
<h2 id="search">Search<a class="zola-anchor" href="#search" aria-label="Anchor link for: search"><i class="fas fa-link"></i></a> 
</h2>
<p>This involves having a kmer, the substring of a genome, and searching for its
most likely position in the graph.
I have multiple problems with this as of now such as completely not finding
kmers at all or having them point to the wrong location.</p>
<h3 id="complementarity">Complementarity<a class="zola-anchor" href="#complementarity" aria-label="Anchor link for: complementarity"><i class="fas fa-link"></i></a> 
</h3>
<p>Graphite doesn't support complementarity (only supports the positive strands)
therefore searching for a kmer in the negative strand wouldn't even work.
I am evaluating different ways of implementing complementarity.</p>
<h3 id="a-graph-extension-of-the-burrows-wheeler-transform">A Graph Extension of the Burrows-Wheeler Transform<a class="zola-anchor" href="#a-graph-extension-of-the-burrows-wheeler-transform" aria-label="Anchor link for: a-graph-extension-of-the-burrows-wheeler-transform"><i class="fas fa-link"></i></a> 
</h3>
<p>Search doesn't work for some strings and even worse the method I am using to
build the index is not ideal. Currently, I am building the FM index via a
Burrows-Wheeler Transform (BWT) which is in turn built from rotating the given
string, this is far from ideal.
A better strategy I am considering is:</p>
<ol>
<li>generate a suffix tree via <a href="https://en.wikipedia.org/wiki/Ukkonen%27s_algorithm">Ukkonen's algorithm</a></li>
<li>traverse the suffix tree via a depth-first search to build a suffix array</li>
<li>use the suffix array to generate a BWT</li>
</ol>
<p>I could then complement the BWT and then generate the FM index and therefore
get fast queries onto the graph.
I believe this to be the basic idea behind
<a href="https://www.biorxiv.org/content/10.1101/051409v1">A Graph Extension of the Positional Burrows-Wheeler Transform and its Applications</a>.</p>
<h2 id="adding-a-metadata-field">Adding a Metadata Field<a class="zola-anchor" href="#adding-a-metadata-field" aria-label="Anchor link for: adding-a-metadata-field"><i class="fas fa-link"></i></a> 
</h2>
<p>We could add a metadata field to the nodes which will allow for something
like inbuilt annotation support.</p>
<h2 id="miscellaneous">Miscellaneous<a class="zola-anchor" href="#miscellaneous" aria-label="Anchor link for: miscellaneous"><i class="fas fa-link"></i></a> 
</h2>
<p>Another feature not related to Bioinformatics but is surprisingly lacking in Racket
is to extend <a href="https://github.com/racket/racket/blob/master/racket/collects/racket/cmdline.rkt">cmdline</a> to have command-line options as is described in
<a href="https://pavpanchekha.com/blog/multi-command-line.html">Multi-command-line in Racket</a>.</p>
<p>To reiterate, you can look at these 3 other posts regarding Graphite:</p>
<ul>
<li><a href="https://blog.njagi.me/google-summer-of-code-2019-final-submission/2019-06-22-Introduction-to-Variation-Graphs.html">An Introduction to Variation Graphs</a></li>
<li><a href="https://blog.njagi.me/google-summer-of-code-2019-final-submission/2019-07-15-Creating-the-Initial-Variation-Graph.html">Creating the Initial Variation Graph</a></li>
<li><a href="https://blog.njagi.me/google-summer-of-code-2019-final-submission/2019-07-21-Justifying-SHA256-in-Graphite.html">Justifying SHA256 in Graphite</a></li>
</ul>
<h1 id="acknowledgements">Acknowledgements<a class="zola-anchor" href="#acknowledgements" aria-label="Anchor link for: acknowledgements"><i class="fas fa-link"></i></a> 
</h1>
<p>I'd like to acknowledge the contribution of the following organizations and people.</p>
<p>Sponsors:</p>
<ul>
<li><a href="https://summerofcode.withgoogle.com">Google Summer of Code</a></li>
<li><a href="https://www.open-bio.org">Open Bioinformatics Foundation</a></li>
</ul>
<p>my mentors:</p>
<ul>
<li><a href="https://github.com/george-githinji">George Githinji</a></li>
<li><a href="https://github.com/pjotrp">Pjotr Prins</a></li>
</ul>
<p>and those who weren't my mentors but helped along the way by offering
technical advice, testing graphite, reading the code or reviewing the blog posts:</p>
<ul>
<li><a href="https://github.com/alanorth">Alan Orth</a></li>
<li><a href="https://github.com/ekg">Erik Garrison</a></li>
<li><a href="https://github.com/jasonrogena">Jason Rogena</a></li>
<li><a href="https://github.com/hipstermojo">Kenneth Gitere</a></li>
<li><a href="https://github.com/kevthanewversi">Kevin Murimi</a></li>
</ul>


    </section>
    <footer>
      <hr>
      <div>
        
        <div class="post-tags">
          <p>Tags:
            
            <a href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;tags&#x2F;gsoc&#x2F;">GSoC, </a>
            
            <a href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;tags&#x2F;google-summer-of-code&#x2F;">Google Summer of Code, </a>
            
            <a href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;tags&#x2F;variation-graphs&#x2F;">Variation Graphs, </a>
            
            <a href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;tags&#x2F;bioinformatics&#x2F;">Bioinformatics, </a>
            
            <a href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;tags&#x2F;graphite&#x2F;">Graphite, </a>
            
          </p>
        </div>
        

        
        <div class="post-tags">
          <p>Categories:
            
            <a href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;categories&#x2F;posts&#x2F;">Posts</a>
            
          </p>
        </div>
        
      </div>
        <nav class="c-pagination p-pagination">
            <div class="c-pagination__ctrl">
                <div class="c-pagination__newer">
                    <a href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;encrypted-flash-drive&#x2F;">Encrypting and decypting a flash drive</a>
                </div>
                <div class="c-pagination__older">
                    <a href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;justifying-sha256-in-graphite&#x2F;">Jusifying SHA256 in Graphite</a>
                </div>
            </div>
        </nav>
    </footer>
</article>
        </main>

        <footer class="l-footer">
          <div id="socials">
            <span class="social-item"><i class="fab fa-github"></i><a target="_blank" href="https://github.com/urbanslug">urbanslug</a></span>
            <span class="social-item"><i class="fab fa-twitter"></i><a target="_blank" href="https://twitter.com/urbanslug">urbanslug</a></span>
          </div>
          <p class="p-copyright">
              
              
    All work is under the terms of the <a href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License, Version 1.3</a>

          </p>
      </footer>

      
      <link rel="stylesheet" href="https:&#x2F;&#x2F;blog.njagi.me&#x2F;css&#x2F;katex.min.css">
      <script defer src="https:&#x2F;&#x2F;blog.njagi.me&#x2F;js&#x2F;katex.min.js"></script>
      <script defer src="https:&#x2F;&#x2F;blog.njagi.me&#x2F;js&#x2F;mathtex-script-type.min.js"></script>
    </body>
</html>
